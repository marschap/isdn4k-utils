
#----------------------------------------------------------------------------#
# Things you can change to personalize the Makefile for your own site.       #
# Please do not change any path values here (the values are stored in some   #
# other files too) - instead use "configure" to change!                      #
#                                                                            #
# Changes to Makefile will get lost if you re-run the configuration script!  #
#----------------------------------------------------------------------------#

#----------------------------------------------------------------------------#
# Default directory tree in which to install the vbox specific files. The    #
# value specified here *MUST* be overridden at configure-time with the       #
# "--prefix" and "--exec-prefix" options to the "configure" script           #
# [/usr/local/vbox]:                                                         #
#----------------------------------------------------------------------------#

prefix		= @prefix@
exec_prefix	= @exec_prefix@

#----------------------------------------------------------------------------#
# Directory in which normal binaries should be installed. The value          #
# specified here *MUST* be overridden at configure-time with the "--bindir"  #
# option to the "configure" script [/usr/local/vbox/bin]:                    #
#----------------------------------------------------------------------------#

bindir		= @bindir@

#----------------------------------------------------------------------------#
# Directory in which system binaries (only started by system or root) should #
# be installed. The value specified here *MUST* be overridden at configure-  #
# time with the "--sbindir" option to the "configure" script                 #
# [/usr/local/vbox/sbin]:                                                    #
#----------------------------------------------------------------------------#

sbindir		= @sbindir@

#----------------------------------------------------------------------------#
# Directory in which configurations should be installed. The value specified #
# here *MUST* be overridden at configure-time with the "--sysconfdir" option #
# to the "configure" script [/usr/local/vbox/etc]:                           #
#----------------------------------------------------------------------------#

sysconfdir	= @sysconfdir@

#----------------------------------------------------------------------------#
# Directory in which the user messages are stored. The value specified here  #
# *MUST* be overridden at configure-time with the "--with-spooldir" option   #
# to the "configure" script [/var/spool/vbox]:                               #
#----------------------------------------------------------------------------#

SPOOLDIR	= @VBOX_SPOOLDIR@

#----------------------------------------------------------------------------#
# Name of the logfile each vboxgetty writes to. The placeholder '%s' is      #
# replaced at runtime by the name of the used tty device. The directory      #
# *MUST* be overridden at configure-time with the "--with-logdir" option to  #
# the "configure" script [/var/log]:                                         #
#----------------------------------------------------------------------------#

LOGFILE		= @VBOX_LOGDIR@/vboxgetty-%s.log

#----------------------------------------------------------------------------#
# Name of the file each vboxgetty save his PID. The placeholder '%s' is      #
# replaced at runtime by the name of the used tty device. The directory      #
# *MUST* be overridden at configure-time with the "--with-piddir" option to  #
# the "configure" script [/var/run]:                                         #
#----------------------------------------------------------------------------#

PIDFILE		= @VBOX_PIDDIR@/vboxgetty-%s.pid

#----------------------------------------------------------------------------#
# Name of the file each vboxgetty lock the used tty. The placeholder '%s' is #
# replaced at runtime by the name of the used tty device. The directory      #
# *MUST* be overridden at configure-time with the "--with-lockdir" option to #
# the "configure" script [/var/run]:                                         #
#----------------------------------------------------------------------------#

LOCKFILE	= @VBOX_LOCKDIR@/LCK..%s

#----------------------------------------------------------------------------#
# Directory in which vbox looks for the global isdn configuration. The value #
# specified here *MUST* be overridden at configure-time with the             #
# "--with-i4lconfdir" option to the "configure" script [$I4LCONFDIR]:        #
#----------------------------------------------------------------------------#

ISDN_GLOB_CONF	= @ISDN_GLOBAL_CONFIG@

#----------------------------------------------------------------------------#
# Program to install binaries to the sbin directory:                         #
#----------------------------------------------------------------------------#

INSTALL_SBIN	= @INSTALL@ -m 750 -o root -g root -s

#----------------------------------------------------------------------------#
# Program to install binaries to the bin directory:                          #
#----------------------------------------------------------------------------#

INSTALL_BIN	= @INSTALL@ -m 755 -o root -g root -s

#----------------------------------------------------------------------------#
# Program to install bash scripts to the bin directory:                      #
#----------------------------------------------------------------------------#

INSTALL_SHBIN	= @INSTALL@ -m 755 -o root -g root

#----------------------------------------------------------------------------#
# Program to install configurations to sysconf directory:                    #
#----------------------------------------------------------------------------#

INSTALL_SYSCONF	= @INSTALL@ -m 644 -o root -g root

#----------------------------------------------------------------------------#
# Program to create missing directories:                                     #
#----------------------------------------------------------------------------#

INSTALL_DIRS	= @INSTALL@ -d

#----------------------------------------------------------------------------#
# Path and names for some needed programs:                                   #
#----------------------------------------------------------------------------#

MAKE		= @VBOX_MAKE@
ECHO		= @VBOX_ECHO@
MV		= @VBOX_MV@
RM		= @VBOX_RM@
SED		= @VBOX_SED@
LN		= @LN_S@
MAILCMD		= @VBOX_MAIL@
AR		= @VBOX_AR@
RANLIB		= @VBOX_RANLIB@

#----------------------------------------------------------------------------#
# The information below is modified by the configure script when Makefile is #
# generated from Makefile.in. You shouldn't normally modify any of this      #
# stuff by hand.                                                             #
#----------------------------------------------------------------------------#

CC		= @CC@
CFLAGS		= @CFLAGS@
TOPDIR		= @srcdir@
SRCDIR		= $(TOPDIR)/src
RUNTIMEFILE	= $(SRCDIR)/runtime.h
VERSION		= @VBOX_VERSION@
VERDATE		= @VBOX_VERDATE@
GOT_LIB_NCURSES = @VBOX_LIB_NCURSES@

#----------------------------------------------------------------------------#
# The information below should be usable as is. The configure script won't   #
# modify it and you shouldn't need to modify it either.                      #
#----------------------------------------------------------------------------#

.EXPORT_ALL_VARIABLES:

all:		  vboxlib vboxgetty vboxconvert sedconvert

#----------------------------------------------------------------------------#
# vboxgetty                                                                  #
#----------------------------------------------------------------------------#

vboxgetty:	  createconfig
		  @$(ECHO) ""
		  @$(ECHO) "        .+'''+.       "
		  @$(ECHO) "Compiling vboxgetty..."
		  @$(ECHO) "'+...+'         '+...+"
		  @$(ECHO) ""
		  @$(MAKE) -C $(TOPDIR)/src vboxgetty

#----------------------------------------------------------------------------#
# vbox                                                                       #
#----------------------------------------------------------------------------#

ifeq ($(GOT_LIB_NCURSES),y)

vbox:		  createconfig
		  @$(ECHO) ""
		  @$(ECHO) "        .+'''+.  "
		  @$(ECHO) "Compiling vbox..."
		  @$(ECHO) "'+...+'         '"
		  @$(ECHO) ""
		  @$(MAKE) -C $(TOPDIR)/src vbox

endif

#----------------------------------------------------------------------------#
# vboxconvert                                                                #
#----------------------------------------------------------------------------#

vboxconvert:	  createconfig
		  @$(ECHO) ""
		  @$(ECHO) "        .+'''+.         "
		  @$(ECHO) "Compiling vboxconvert..."
		  @$(ECHO) "'+...+'         '+...+' "
		  @$(ECHO) ""
		  @$(MAKE) -C $(TOPDIR)/src vboxconvert

#----------------------------------------------------------------------------#
# vboxlib                                                                    #
#----------------------------------------------------------------------------#

vboxlib:	  createconfig
		  @$(ECHO) ""
		  @$(ECHO) "        .+'''+.         .+'''+.  "
		  @$(ECHO) "Compiling vbox support library..."
		  @$(ECHO) "'+...+'         '+...+'         '"
		  @$(ECHO) ""
		  @$(MAKE) -C $(TOPDIR)/src vboxlib

#----------------------------------------------------------------------------#
# sedconvert                                                                 #
#----------------------------------------------------------------------------#

sedconvert:	  ignore
		  @$(ECHO) ""
		  @$(ECHO) "        .+'''+.         .+'''+.       "
		  @$(ECHO) "Creating utilities & documentations..."
		  @$(ECHO) "'+...+'         '+...+'         '+...+"
		  @$(ECHO) ""
		  @$(TOPDIR)/utils/mksed <$(TOPDIR)/utils/vboxmail.in >$(TOPDIR)/utils/vboxmail
		  @$(TOPDIR)/utils/mksed <$(TOPDIR)/utils/vboxplay.in >$(TOPDIR)/utils/vboxplay

#----------------------------------------------------------------------------#
# install program & settings...                                              #
#----------------------------------------------------------------------------#

install:	  install-dirs

		  @$(ECHO) ""
		  @$(ECHO) "        .+'''+.         .+'''+.        "
		  @$(ECHO) "Installing programs & configurations..."
		  @$(ECHO) "'+...+'         '+...+'         '+...+'"
		  @$(ECHO) ""

		  @$(ECHO) "Installing '$(sbindir)/vboxgetty'..."
		  @$(INSTALL_SBIN) $(TOPDIR)/src/vboxgetty $(sbindir)/vboxgetty

		  @$(ECHO) "Installing '$(sysconfdir)/vboxgetty.conf.example'..."
		  @$(INSTALL_SYSCONF) $(TOPDIR)/examples/vboxgetty.conf.example $(sysconfdir)

ifeq ($(GOT_LIB_NCURSES),y)
		  @$(ECHO) "Installing '$(bindir)/vbox'..."
		  @$(INSTALL_BIN) $(TOPDIR)/src/vbox $(bindir)
endif

		  @$(ECHO) "Installing '$(bindir)/vboxconvert'..."
		  @$(INSTALL_BIN) $(TOPDIR)/src/vboxconvert $(bindir)
		  @cd $(bindir); \
		  $(LN) -f vboxconvert vboxtoau; \
		  $(LN) -f vboxconvert autovbox; \
		  $(LN) -f vboxconvert vboxmode;

		  @$(ECHO) "Installing '$(bindir)/vboxmail'..."
		  @$(INSTALL_SHBIN) $(TOPDIR)/utils/vboxmail $(bindir)

		  @$(ECHO) "Installing '$(bindir)/vboxplay'..."
		  @$(INSTALL_SHBIN) $(TOPDIR)/utils/vboxplay $(bindir)


#----------------------------------------------------------------------------#
# install directories...                                                     #
#----------------------------------------------------------------------------#

MAKETHISDIRS	= $(prefix) $(exec_prefix) $(sbindir) $(bindir) \
		  $(sysconfdir) $(SPOOLDIR)

install-dirs:	  ignore

		  @$(ECHO) ""
		  @$(ECHO) "        .+'''+.        "
		  @$(ECHO) "Creating directories..."
		  @$(ECHO) "'+...+'         '+...+'"
		  @$(ECHO) ""

		  @set -e; for i in $(MAKETHISDIRS); do \
		     $(ECHO) -n "Checking '$$i'... "; \
		     if [ -d $$i ]; then \
		        $(ECHO) "it's here."; \
		     else \
		        $(ECHO) "creating..."; \
		        $(INSTALL_DIRS) $$i; \
		     fi; \
		  done

#----------------------------------------------------------------------------#
# create runtime configuration...                                            #
#----------------------------------------------------------------------------#

createconfig:	ignore
		@$(ECHO) "/* Generated at runtime */" >$(RUNTIMEFILE)
		@$(ECHO) "#define VERSION \"$(VERSION)\"" >>$(RUNTIMEFILE)
		@$(ECHO) "#define VERDATE \"$(VERDATE)\"" >>$(RUNTIMEFILE)
		@$(ECHO) "#define SPOOLDIR \"$(SPOOLDIR)\"" >>$(RUNTIMEFILE)
		@$(ECHO) "#define LOGFILE \"$(LOGFILE)\"" >>$(RUNTIMEFILE)
		@$(ECHO) "#define PIDFILE \"$(PIDFILE)\"" >>$(RUNTIMEFILE)
		@$(ECHO) "#define LOCKFILE \"$(LOCKFILE)\"" >>$(RUNTIMEFILE)
		@$(ECHO) "#define BINDIR  \"$(bindir)\"" >>$(RUNTIMEFILE)
		@$(ECHO) "#define GETTYRC \"$(sysconfdir)/vboxgetty.conf\"" >>$(RUNTIMEFILE)
		@$(ECHO) "#define I4LCONFDIR \"$(ISDN_GLOB_CONF)\"" >>$(RUNTIMEFILE)

#----------------------------------------------------------------------------#
# misc                                                                       #
#----------------------------------------------------------------------------#

distclean:	  clear
		  @$(RM) -f $(TOPDIR)/Makefile
		  @$(RM) -f $(TOPDIR)/src/Makefile
		  @$(RM) -f $(TOPDIR)/src/configs.h
		  @$(RM) -f $(TOPDIR)/doc/Makefile
		  @$(RM) -f $(TOPDIR)/utils/vboxmail
		  @$(RM) -f $(TOPDIR)/utils/vboxplay
		  @$(RM) -f config.cache config.log config.status

clean:		  ignore
		  @$(RM) -f $(TOPDIR)/*~
		  @$(RM) -f $(TOPDIR)/src/*~
		  @$(RM) -f $(TOPDIR)/doc/*~
		  @$(RM) -f $(TOPDIR)/examples/*~
		  @$(RM) -f $(TOPDIR)/utils/*~

clear:		  clean
		  @$(RM) -f $(TOPDIR)/src/*.[oas]
		  @$(RM) -f $(TOPDIR)/src/vboxgetty
		  @$(RM) -f $(TOPDIR)/src/vbox
		  @$(RM) -f $(TOPDIR)/src/vboxconvert
		  @$(RM) -f $(TOPDIR)/doc/*.html
		  @$(RM) -f $(TOPDIR)/doc/*.sgml
		  @$(RM) -f $(TOPDIR)/doc/*.txt
		  @$(RM) -f $(RUNTIMEFILE)

ignore:
