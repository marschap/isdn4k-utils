# Makefile fuer i4l-faq
# (c) 1997 by Matthias Heßler (MatHes)
#
# Erzeugt FAQ etc.

# Directories
# BIN enthaelt alle Perl-Skripte
BIN = ./bin
# in OUT werden alle Output-Dateien erzeugt
GEN_DIR = ./out
# Für Bernhard:
#TARGET_DIR = /home/dl4mhk/www/i4l-faq
# Ich selbst behalte den Kram lieber da, wo er erzeugt wurde:
TARGET_DIR = @TARGET_DIR@

# Programm-Namen
ZIP     = @C_ZIP@
GZIP    = @C_GZIP@
PERL    = @C_PERL@
INSTALL = @INSTALL@
HTML    = $(PERL) $(BIN)/html.pl
7BIT    = $(PERL) $(BIN)/7bit.pl
OLD     = $(PERL) $(BIN)/old.pl
NEW     = $(PERL) $(BIN)/new.pl

# Quell-Dateien
SRC = de-i4l-faq
OLD_SRC = $(SRC).old
SRC_DIFF = $(SRC).diff

SRC_ENG = eng-i4l-faq
OLD_SRC_ENG = $(SRC_ENG).old
SRC_ENG_DIFF = $(SRC_ENG).diff

# Ausgabe-Dateien
OUT_7BIT = $(SRC).asc
OUT_HTML = $(SRC).html
OUT_ENG_7BIT = $(SRC_ENG).asc
OUT_ENG_HTML = $(SRC_ENG).html


# Aufrufe zur Erzeugung verschiedener FAQ-Versionen:
# alles
all:	7bit html e7bit ehtml \
	7bit.zip html.zip e7bit.zip ehtml.zip \
	7bit.gz html.gz e7bit.gz ehtml.gz

# deutsche 7Bit-Version
7bit: $(GEN_DIR)/$(OUT_7BIT)
7bit.zip: $(GEN_DIR)/$(OUT_7BIT).zip
7bit.gz: $(GEN_DIR)/$(OUT_7BIT).gz

$(GEN_DIR)/$(OUT_7BIT): $(SRC)
	$(7BIT) $(SRC) $(GEN_DIR)/$(OUT_7BIT)
$(GEN_DIR)/$(OUT_7BIT).zip: $(GEN_DIR)/$(OUT_7BIT)
	$(ZIP) -l $(GEN_DIR)/$(OUT_7BIT).zip $(GEN_DIR)/$(OUT_7BIT)
$(GEN_DIR)/$(OUT_7BIT).gz: $(GEN_DIR)/$(OUT_7BIT)
	$(GZIP) -cf $(GEN_DIR)/$(OUT_7BIT) > $(GEN_DIR)/$(OUT_7BIT).gz


# deutsche HTML-Version
html: $(GEN_DIR)/$(OUT_HTML)
html.zip: $(GEN_DIR)/$(OUT_HTML).zip
html.gz: $(GEN_DIR)/$(OUT_HTML).gz

$(GEN_DIR)/$(OUT_HTML): $(SRC)
	$(HTML) $(SRC) $(GEN_DIR)/$(OUT_HTML)
$(GEN_DIR)/$(OUT_HTML).zip: $(GEN_DIR)/$(OUT_HTML)
	$(ZIP) -l $(GEN_DIR)/$(OUT_HTML).zip $(GEN_DIR)/$(OUT_HTML)
$(GEN_DIR)/$(OUT_HTML).gz: $(GEN_DIR)/$(OUT_HTML)
	$(GZIP) -cf $(GEN_DIR)/$(OUT_HTML) > $(GEN_DIR)/$(OUT_HTML).gz


# deutsches Diff erzeugen
dif:
	[ ! -e $(SRC_DIFF) ] # Diff nur erzeugen, wenn noch nicht vorhanden
	diff -u $(OLD_SRC) $(SRC) > $(SRC_DIFF); echo -n

# deutsches Diff einspielen
pat:
	[ -e $(SRC_DIFF) ] # Nur patchen wenn diff vorhanden
	patch $(SRC) < $(SRC_DIFF)
	if [ -e $(SRC).orig ]; then mv $(SRC).orig $(OLD_SRC); fi

# Alle Fragen der deutschen FAQ als NEU deklarieren
new:
	$(NEW) $(SRC)

# Alle Fragen der deutschen FAQ als ALT deklarieren
old:
	$(OLD) $(SRC)


# englische 7Bit-Version
e7bit: $(GEN_DIR)/$(OUT_ENG_7BIT)
e7bit.zip: $(GEN_DIR)/$(OUT_ENG_7BIT).zip
e7bit.gz: $(GEN_DIR)/$(OUT_ENG_7BIT).gz

$(GEN_DIR)/$(OUT_ENG_7BIT): $(SRC)
	$(7BIT) $(SRC_ENG) $(GEN_DIR)/$(OUT_ENG_7BIT)
$(GEN_DIR)/$(OUT_ENG_7BIT).zip: $(GEN_DIR)/$(OUT_ENG_7BIT)
	$(ZIP) -l $(GEN_DIR)/$(OUT_ENG_7BIT).zip $(GEN_DIR)/$(OUT_ENG_7BIT)
$(GEN_DIR)/$(OUT_ENG_7BIT).gz: $(GEN_DIR)/$(OUT_ENG_7BIT)
	$(GZIP) -cf $(GEN_DIR)/$(OUT_ENG_7BIT) > $(GEN_DIR)/$(OUT_ENG_7BIT).gz


# englische HTML-Version
ehtml: $(GEN_DIR)/$(OUT_ENG_HTML)
ehtml.zip: $(GEN_DIR)/$(OUT_ENG_HTML).zip
ehtml.gz: $(GEN_DIR)/$(OUT_ENG_HTML).gz

$(GEN_DIR)/$(OUT_ENG_HTML): $(SRC)
	$(HTML) $(SRC_ENG) $(GEN_DIR)/$(OUT_ENG_HTML)
$(GEN_DIR)/$(OUT_ENG_HTML).zip: $(GEN_DIR)/$(OUT_ENG_HTML)
	$(ZIP) -l $(GEN_DIR)/$(OUT_ENG_HTML).zip $(GEN_DIR)/$(OUT_ENG_HTML)
$(GEN_DIR)/$(OUT_ENG_HTML).gz: $(GEN_DIR)/$(OUT_ENG_HTML)
	$(GZIP) -cf $(GEN_DIR)/$(OUT_ENG_HTML) > $(GEN_DIR)/$(OUT_ENG_HTML).gz


# englisches Diff erzeugen
edif:
	[ ! -e $(SRC_ENG_DIFF) ] # Diff nur erzeugen, wenn noch nicht vorhanden
	diff -u $(OLD_SRC_ENG) $(SRC_ENG) > $(SRC_ENG_DIFF); echo -n

# englisches Diff einspielen
epat:
	[ -e $(SRC_ENG_DIFF) ] # Nur patchen wenn diff vorhanden
	patch $(SRC_ENG) < $(SRC_ENG_DIFF)
	if [ -e $(SRC_ENG).orig ]; then mv $(SRC_ENG).orig $(OLD_SRC_ENG); fi

# Alle Fragen der englischen FAQ als NEU deklarieren
enew:
	$(NEW) $(SRC_ENG)

# Alle Fragen der englischen FAQ als ALT deklarieren
eold:
	$(OLD) $(SRC_ENG)


# Erzeugte Dateien installieren
install: all
	if [ $(TARGET_DIR) != $(GEN_DIR) ]; then \
		$(INSTALL) -m 0755 -d $(TARGET_DIR); \
		$(INSTALL) -m 0644 $(GEN_DIR)/* $(TARGET_DIR); \
	fi

# Erzeugte Dateien deinstallieren
uninstall:
	set -e; allow_null_glob_expansion=1; \
	if [ $(TARGET_DIR) != $(GEN_DIR) ]; then \
		cd $(TARGET_DIR); \
		for i in $(OUT_7BIT) $(OUT_HTML) $(OUT_ENG_7BIT) $(OUT_ENG_HTML) ; do \
			rm -f $$i $$i.zip $$i.gz ; \
		done; \
	fi

# Aufraeumen
clean:
	if [ -e *~ ]; then rm *~; fi
	if [ -e \#* ]; then rm \#*; fi
	set -e; allow_null_glob_expansion=1; \
	cd $(GEN_DIR); \
	for i in $(OUT_7BIT) $(OUT_HTML) $(OUT_ENG_7BIT) $(OUT_ENG_HTML) ; do \
		rm -f $$i $$i.zip $$i.gz ; \
	done

config:
	./configure

distclean: clean
	rm -f config.* Makefile
