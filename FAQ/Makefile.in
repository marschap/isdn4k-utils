# Makefile for i4l-faq
# (c) 1997 by Matthias Heßler (MatHes)
#
# Generate FAQ, support FAQ development

# Directories
# All output files are generated in GEN_DIR
GEN_DIR = ./out
# After generation, install files in TARGET_DIR (if different from GEN_DIR)
TARGET_DIR = @TARGET_DIR@

# Program file names
ZIP     = @C_ZIP@
GZIP    = @C_GZIP@
SGML2HTML = @C_SGML2HTML@
SGML2TXT = @C_SGML2TXT@
INSTALL = @INSTALL@

# Source file names
SRC = i4lfaq.sgml
OUT_NAME = i4lfaq
OUT_HTML = $(OUT_NAME).html
# please note that also files like i4lfaq-1.html, i4lfaq-11.html,...
# will be generated...
OUT_TXT = $(OUT_NAME).txt


# *** Generate FAQ ***

# Generate all FAQ versions
all: Makefile $(GEN_DIR) html txt

$(GEN_DIR):
	-mkdir -p $(GEN_DIR)


# Generate html version of FAQ
html: $(GEN_DIR)/$(OUT_HTML)

$(GEN_DIR)/$(OUT_HTML):
	cp $(SRC) $(GEN_DIR); cd $(GEN_DIR); $(SGML2HTML) $(SRC); rm $(SRC)


# Generate text version of FAQ
txt: $(GEN_DIR)/$(OUT_TXT)

$(GEN_DIR)/$(OUT_TXT):
	cp $(SRC) $(GEN_DIR); cd $(GEN_DIR); $(SGML2TXT) $(SRC); rm $(SRC)


# Generate all zip versions
zip: $(GEN_DIR)/$(OUT_NAME)-sgml.zip $(GEN_DIR)/$(OUT_NAME)-html.zip $(GEN_DIR)/$(OUT_NAME)-txt.zip 
gz: $(GEN_DIR)/$(OUT_NAME)-sgml.gz $(GEN_DIR)/$(OUT_NAME)-html.gz $(GEN_DIR)/$(OUT_NAME)-txt.gz 


# Compress sgml
$(GEN_DIR)/$(OUT_NAME)-sgml.zip: $(SRC)
	$(ZIP) -l $(GEN_DIR)/$(OUT_NAME)-sgml.zip $(SRC)
$(GEN_DIR)/$(OUT_NAME)-sgml.gz: $(SRC)
	$(GZIP) -cf $(SRC) > $(GEN_DIR)/$(OUT_NAME)-sgml.gz

# Compress html
# Please note, that all html files will be compressed under $(GEN_DIR)
$(GEN_DIR)/$(OUT_NAME)-html.zip: $(GEN_DIR)/$(OUT_NAME).html
	$(ZIP) -l $(GEN_DIR)/$(OUT_NAME)-html.zip $(GEN_DIR)/$(OUT_NAME)*.html
$(GEN_DIR)/$(OUT_NAME)-html.gz: $(GEN_DIR)/$(OUT_NAME).html
	$(GZIP) -cf $(GEN_DIR)/$(OUT_NAME)*.html > $(GEN_DIR)/$(OUT_NAME)-html.gz

# Compress txt
# Please note, that txt file will be compressed under $(GEN_DIR)
$(GEN_DIR)/$(OUT_NAME)-txt.zip: $(GEN_DIR)/$(OUT_TXT)
	$(ZIP) -l $(GEN_DIR)/$(OUT_NAME)-txt.zip $(GEN_DIR)/$(OUT_TXT)
$(GEN_DIR)/$(OUT_NAME)-txt.gz: $(GEN_DIR)/$(OUT_TXT)
	$(GZIP) -cf $(GEN_DIR)/$(OUT_TXT) > $(GEN_DIR)/$(OUT_NAME)-txt.gz


# *** General Stuff ***

# Install output files
install: all
	if [ $(TARGET_DIR) != $(GEN_DIR) ]; then \
		$(INSTALL) -m 0755 -d $(DESTDIR)$(TARGET_DIR); \
		$(INSTALL) -m 0644 `find $(GEN_DIR) -maxdepth 1 -type f` $(DESTDIR)$(TARGET_DIR); \
	fi

# Un-install output files
uninstall:
	set -e; \
	if [ $(TARGET_DIR) != $(GEN_DIR) ]; then \
		cd $(DESTDIR)$(TARGET_DIR); \
		for i in $(OUT_NAME)*.html ; do \
			rm -f $$i ; \
		done ; \
		rm -f $(OUT_TXT) ; \
	fi

# Cleanup
clean:
	if [ -e *~ ]; then rm *~; fi
	if [ -e \#* ]; then rm \#*; fi
	if [ -e *.orig ]; then rm *.orig; fi
	set -e; \
	cd $(GEN_DIR); \
	if [ -e $(OUT_TXT) ]; then rm -f $(OUT_TXT); fi; \
	if [ -e $(OUT_NAME)-sgml.zip ]; then rm -f $(OUT_NAME)-sgml.zip; fi; \
	if [ -e $(OUT_NAME)-sgml.gz ]; then rm -f $(OUT_NAME)-sgml.gz; fi; \
	if [ -e $(OUT_NAME)-html.zip ]; then rm -f $(OUT_NAME)-html.zip; fi; \
	if [ -e $(OUT_NAME)-html.gz ]; then rm -f $(OUT_NAME)-html.gz; fi; \
	if [ -e $(OUT_NAME)-txt.zip ]; then rm -f $(OUT_NAME)-txt.zip; fi; \
	if [ -e $(OUT_NAME)-txt.gz ]; then rm -f $(OUT_NAME)-txt.gz; fi; \
	for i in $(OUT_NAME)*.html ; do \
		rm -f $$i ; \
	done

config:
	./configure

Makefile: Makefile.in config.status
	./config.status

config.status: configure
	./config.status --recheck

distclean: clean
	rm -f config.* Makefile
