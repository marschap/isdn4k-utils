# $Id: Makefile.in,v 1.7 1997/10/23 22:39:06 fritz Exp $
#
# Makefile for isdnctrl
# (C) 1997 Fritz Elfert
#
#
SHELL			  = /bin/sh
CFLAGS			= -Wall -O2 -I. -I@KINCLUDE@ $(ISDN_INCLUDE)
LDFLAGS			= @LIBS@ 
DBMLIB 			= @DBMLIB@
PROGRAM			= isdnctrl
MODULES			= isdnctrl.o
MANPAGES		= isdnctrl.8
INSTALL			= @INSTALL@
INSTALL_PROGRAM	= $(INSTALL) -o 0 -g 0 -m 0750
INSTALL_MAN		= $(INSTALL) -o 0 -g 0 -m 0644
CC				= @CC@ -DVERSION=\"$(I4LVERSION)\"
prefix			= @prefix@
exec_prefix		= @exec_prefix@
ifeq (../.config,$(wildcard ../.config))
	include ../.config
	SBINDIR			= $(CONFIG_SBINDIR)
	mandir			= $(shell echo $(CONFIG_MANDIR))
else
	SBINDIR			= /sbin
	mandir			= @mandir@
endif
MAN8DIR			= $(mandir)/man8

ifdef CONFIG_CTRL_CONF
CC			+= -DI4L_CTRL_CONF
LDFLAGS		+= -L../lib -lisdn $(DBMLIB) 
MODULES		+= ctrlconf.o
MANPAGES    += .isdnctrl_conf.8
endif

.SUFFIXES:
.SUFFIXES: .c .o

all: $(PROGRAM)

config:
	@./configure

%.8: %.man
ifdef CONFIG_CTRL_CONF
	cat $< | sed -e 's%@MANINC@%.so%' -e "s%@MAN8DIR@%$(MAN8DIR)%" > $@
else
	cat $< | sed -e 's%@MANINC@%.\\\"%' -e "s%@MAN8DIR@%$(MAN8DIR)%" > $@
endif

$(PROGRAM):	$(MODULES)
	$(CC) $(CFLAGS) $(MODULES) $(LDFLAGS) -o $@

install-man: $(MANPAGES)
	$(INSTALL) -d $(MAN8DIR)
	$(INSTALL_MAN) $^ $(MAN8DIR)

install: $(PROGRAM) install-man
	$(INSTALL) -d $(SBINDIR)
	$(INSTALL_PROGRAM) $(PROGRAM) $(SBINDIR)/$(PROGRAM)

install-strip: $(PROGRAM)
	$(INSTALL) -d $(SBINDIR)
	$(INSTALL_PROGRAM) -s $(PROGRAM) $(SBINDIR)/$(PROGRAM)

uninstall:
	rm -f $(SBINDIR)/$(PROGRAM)
	for i in $(MANPAGES) ; do rm $(MAN8DIR)/$$i ; done

clean:
	rm -f *.o *~ $(PROGRAM) *.man *.8 .*.man .*.8

distclean: clean
	rm -f config.status config.cache config.log config.h Makefile
